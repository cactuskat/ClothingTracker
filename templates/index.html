<!DOCTYPE html>
<html>
<head>
  <title>Cher's Closet</title>
</head>
<body>

  <button id="createBtn" type="button">Create!</button>
  <p id="top"></p>
  <p id="bottom"></p>

  <script>
    const debug = 1;
    // Classes ---
    class Clothing {
      constructor({id=null,name=null,type=null,weather=null,path=null} = {}){
        this.id = id;
        this.name = null;
        this.type = type;
        this.weather = weather;
        this.path = path;}
    }
    class Outfit {
      constructor({top=null, bottom=null, accessory=null} = {}){
        this.top = top; 
        this.bottom = bottom;
        //this.accessory = accessory;
        }
    }

    // Global Variables ---
    const topPiece = new Clothing({type:"top"});
    const bottomPiece = new Clothing({type:"bottom"});
    //const accessory = new Clothing({type:accessory});
    var outfit = new Outfit({top : topPiece,bottom : bottomPiece});
    const createBtn = document.getElementById("createBtn");

    // Methods ---    
    createBtn.addEventListener("click",updateOutfit)
    createBtn.addEventListener("click",updateOutfitImage)

    // Functions ---

    async function fetchClothing(clothingType,weather){
      if (debug) {console.log(`Entering fetchClothing with ${clothingType} & ${weather}`)}
      try {
        const response = await fetch(`/clothing/search?type=${encodeURIComponent(clothingType)}&weather=${encodeURIComponent(weather)}`);
        if (!response.ok) {
          throw new Error(`Fetch error: ${response.status}`);
        }
        const result = await response.json();
        if (debug) {console.log('Parsed JSON data:',result);}
        return result;
      } catch (error) {
        console.error(error.message);
        return null;}
    }

    /*
    Purpose: Selects a piece from the closet database according to the weather
    Input: Clothing (item of outfit), Weather (temp of user)
    Return: VOID
    */
    async function updateClothing(clothingType,weather) {
      const response = await fetchClothing(clothingType,weather);
      if (!response){
        console.log(`No data returned from fetchClothing(${clothingType},${weather})`);
      } else if (response.error){
        console.log("Error from backend:",data.error)
      }
      outfit[clothingType].id = response.id;

      if(debug) console.log("REsulttts:",response.id)
    }

      /*
      console.log("hello world")
      if (data && data.id){
        console.log("Clothing found")
        //outfit.updateItem(clothingType,data.id);
      } else if (data && data.error) {
        console.log("Error from backend:", data.error);
      } else if (!data) {
        console.log("No data returned from fetchClothing");
      } else {
        console.log(":(")
      } */
      //outfit.updateItem(clothingType,clothingType)
      // Assuming data is an array and we want the first item
      //console.log(data[0]); 
      //if (data && data.id) {
      //  outfit.updateItem(clothingType,data.id)
      //} else {
      //  console.log("No clothing found or error")
      //}

    /*
    Purpose: Updates outfit with new pieces according to the weather
    Input: Weather(temp of user)
    Return: VOID
    */
    async function updateOutfit(weather) {
      if (debug) {console.log("entered updateOufit")}
      Object.keys(outfit).forEach(piece => {
        updateClothing(piece,"hot");});
    }

    /*
    Purpose: Updates images to reflect current outfit piece
    Input: NONE
    Return: VOID
    */
    function updateOutfitImage(){
      Object.keys(outfit).forEach(piece => {
        const clothingItem = outfit[piece];
        const element = document.getElementById(piece);

        if (clothingItem && clothingItem.path) {
          element.innerHTML = "image!";
        } else {
          element.innerHTML = "(no image)";
        }
      });
    }
  
  </script>
</body>
</html>
