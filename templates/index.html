<!DOCTYPE html>
<html>
<head>
  <title>Cher's Closet</title>
</head>
<body>

  <button id="createBtn" type="button">Create!</button>
  <p id="top"></p>
  <p id="bottom"></p>

  <script>
    const debug = 1;
    // Classes ---
    class Clothing {
      constructor({id=null,name=null,type=null,weather=null,path=null} = {}){
        this.id = id;
        this.name = null;
        this.type = type;
        this.weather = weather;
        this.path = path;}
    }
    class Outfit {
      constructor({top=null, bottom=null, accessory=null} = {}){
        this.top = top; 
        this.bottom = bottom;
        //this.accessory = accessory;
        }
    }

    // Global Variables ---
    const topClothing = new Clothing({type:"top"});
    const bottomClothing = new Clothing({type:"bottom"});
    var mannequinOutfit = new Outfit({top:topClothing,bottom:bottomClothing});
    const createBtn = document.getElementById("createBtn");

    // Methods ---    
    createBtn.addEventListener("click",async () => {
      await updateManOutfit(); updateOutfitImage();});

    // Functions ---

    /*
    Purpose: Fetches a clothing from closet_list.db
    Input: clothingType,Weather(temp of user)
    Return: clothing object data
    */
    async function fetchClothing(clothingType,weather){
      if (debug) {console.log(`Entering fetchClothing with ${clothingType} & ${weather}`)}
      try {
        const response = await fetch(`/clothing/search?type=${encodeURIComponent(clothingType)}&weather=${encodeURIComponent(weather)}`);
        if (!response.ok) {
          throw new Error(`Fetch error: ${response.status}`);
        }
        const result = await response.json();
        if (debug) {console.log('Parsed JSON data:',result);}
        return result;
      } catch (error) {
        console.error(error.message);
        return null;}
    }

    /*
    Purpose: Updates mannequin outfit with new pieces according to the weather
    Input: Weather(temp of user,string)
    Return: VOID
    */
    async function updateManOutfit(weather) {
      for (const piece of Object.keys(mannequinOutfit)) {
        let response = await fetchClothing(piece,"hot");
        if (!response){
          console.log(`No data returned from fetchClothing(${clothingType},"hot")`);
        } else if (response.error){
          console.log("Error from backend:",response.error)
        }

        mannequinOutfit[piece].id = response.id;
        mannequinOutfit[piece].path = response.path;
        if (debug) {console.log(`updated Mannequin Out with ${piece}:${mannequinOutfit[piece].id}`);}
      }
    }

    /*
    Purpose: Updates mannequinn images to reflect mannequinnOutfit piece
    Input: NONE
    Return: VOID
    */
    function updateOutfitImage(){
      console.log("mannequinnOutift:",mannequinOutfit)
      try {      
        for (const piece of Object.keys(mannequinOutfit)){
          document.getElementById(piece).innerHTML = mannequinOutfit[piece].path;
        }
      } catch{
        console.log("error dressing mannequinn")
      }

    }
  
  </script>
</body>
</html>